---
layout:     post
title:      计算机网络笔记-1
subtitle:   学习
date:       2018-12-26
author:     XHT
header-img: img/post-bg-universe.jpg
catalog: true
tags:
    - 计算机网络
---

## 几种以太网连线方式（拓扑结构

目前的主要网路类似蜘蛛网，为星型拓扑结构

其他的还有环型结构、总线结构、分布式结构、树型结构、网状结构、蜂窝状结构等。（来自百度百科）



##  三种交换方式

> 电路交换

在使用电路交换通话之前，必须先拨号建立链接。从主叫端到被叫端建立一条连接，也就是一条专用的物理通路。这条连接保证了双方通话所需要的通信资源，而这些资源在双方通信时不会被其他用户占用。（sorry，您拨打的用户正在通话中）通信完毕后，交换机则会释放刚才使用的专用物理链路。

这种必须经过“建立连接”，“通话”，”释放连接“ 三个步骤的交换方式叫做电路交换

> 分组交换

分组交换则采用存储转发方式技术，我们把需要发送的整块数据成为一个报文。先将整个报文分割成一小块一小块，再加上一些必要的控制信息（这是第几块，目标地址，源地址）这些控制信息我们也叫做“包头”。由于互联网是由许多网络和把他们连起来的路由器组成的，类似一个网状结构，所以我们在中间过程可以由多条不同的数据链路传输数据，在目标机上通过（控制信息）进行信息拼接成为一个完整的数据（类似迅雷下载时详细信息里的一小块一小块）。在过程中选择路径则是通过路由器进行选择的。即路由器的功能是对分组的存储转发。

> 报文交换

报文交换的信息传输中间过程类似于分组交换，所不同的是报文是没有信息进行分割从而进行分组传输。

## 计算机网络的性能指标

>速率

>带宽

>吞吐量

>时延

1. 发送时延

**发送时延是主机或路由器发送数据帧所需要的时间。计算公式：发送时延=数据帧长度（bit）/发送速率（bit/s）**
2. 传播时延

**传播时延是电磁波在信道中传播一定距离所需要花费的时间（现在大部分是光纤，信息以光速传播）。计算公式：信道长度（m）/电磁波在信道上的传播速率（m/s）  光速为3e5 km/s**
3. 处理时延

**主机或路由器在收到分组时要花费一定的时间进行处理，例如分析分组的首部,从分组中提取数据部分，进行差错检验或查找适当的路由进行转发等。这就缠讼的处理时延**
4. 排队时延

**分组在经过路由器时，有在输入队列中排队等待处理和在输出队列中排队等待转发。这就产生了排队时延，当通信量很大时，就会产生队列溢出覆盖，产使分组丢失，这相当于排队时延为无限大**

> 时延带宽积

网络性能的两个度量————————传播时延和带宽一一相乘，就得到另一个很有用的度量：传播时延带宽，即：时延带宽积=传播时延*带宽

我们可以形象的看作一个管道，管道的截面积是链路的带宽，管道的长度是链路的传播时延。因此时延带宽积就表示这个管道的提及，表示这样的链路可以容纳多少个bit。

> 往返时间RTT

往返时间RTT（Round-Trip Time）。往返时间包括中间各个结点的处理时延，排队时延以及转发数据时的发送时延。

> 利用率

利用率有信道利用率和网络利用率两种。信道利用率指出某信道有百分之几的时间时被利用的（有数据通过）。网络利用率则是全网络的信道利用率的加权平均值。利用率跟网络时延有着显著的关系

我们令D0表示网络空闲时的时延，D表示网络当前的时延，U表示利用率

D=D0/（1-U）

当利用率超过50%之后，时延开始急剧增大

## 分层带来的好处

> 各层之间是独立的

**每一层只实现一种相对独立的功能，并不需要知道它的下一层是如何实现的，我们只需要下一层的接口所提供的福利**

> 灵活性好

**当某一层的功能实现发生变化时，只要层间接口关系保持不变，则在这层以上或以下各层均不受影响**

> 结构上可分割

**各层都可以采用最合适的技术来实现**

> 易于实现和维护

**这种结构使得实现和调试一个庞大而又复杂的系统变得易于处理**

> 能促进标准化工作

1. **差错控制：使相应层次对等方的通信更加可靠**
2. **流量控制：发送端的发送速率必须使接收端来得及接受，不要太快**
3. **分段和重装： 发送端将要发送的数据块划分为更小的单位，在接收端再进行分用。在网络层实现**
4. **复用和分用： 发送端几个高层回话复用一条底层的连接，在接收端再进行分用，在物理层实现**
5. **连接建立和释放：交换数据前先建立一条逻辑连接，传输完毕后释放连接**

## 具有五种协议的体系结构

> 应用层

**应用层是体系结构中的最高层。应用层的任务是通过应用进程间的交互来完成特定网络应用。应用层协议的定义是应用进程间通信和交互的规则。这里的进程就是指主机中正在运行的程序。对于不同的网路应用层需要不同的应用层协议。在互联网中的应用层协议很多，如域名系统DNS，支持万维网应用的HTTP协议，支持电子邮件的SMTP协议，等等。我们把应用层交互的数据但愿成为报文（message）**

1. 传输基本单位为报文

> 运输层

**运输层的任务就是负责向两台主机中进程之间的通信提供通用的数据传输服务。由于一台主机可同时运行多个进程美因茨运输层有复用和奋勇的功能。复用就是多个应用层进程可同时使用下面运输层的服务，分用是运输层把收到的信息分别交付上面应用层中的相应过程。运输层它属于面向通信部分最高层，也是用户功能的最底层，运输层为端到端之间提供逻辑通信**

运输层主要使用以下两种协议：

- **传输控制协议TCP** ------提供面向连接的，可靠的数据传输服务，其数据传输的单位是报文段（尽管下层是不靠谱链接

- **用户数据报协议 UDP** ------提供无连接，尽最大女里的数据传输服务（不保证数据传输的可靠性），其数据传输的单位是用户数据报

 1. TCP建立链接需要客户和服务器之间交换三个TCP报文段(一次握手)
 2. TCP释放链接过程需要四报文握手

 ### TCP的连接建立

 A为运行的TCP客户程序,B为运行TCP服务器程序.B的TCP服务进程先创建**传输控制模块**,负责监听客户端的TCP服务请求.A的TCP客户进程也是首先创建传输控制块TCB.

 在建立TCP连接时,向B发出连接请求报文段.  报文段首部中的同步位SYN=1,同时选择一个初始序号seq=x

 B收到连接请求报文段后,若同意建立连接,则向A发送确认.   B发送确认 SYN位和ACK位都置为1,确认号ack=x+1 位置号seq=y

 A收到B的确认报文后，还要向B给出确认.  发送确认报文 确认号为ack=y+1 位置号seq=x+1

 为什么A最后还要发送一次确认呢？这主要是为了防止已失效的连接请求报文段突然有传送到了B,因而产生错误

 ### TCP如何在不可靠的数据链路层上实现可靠的交付服务？

 1. TCP将报文段进行分组，每个分组上有一个定时器，发送端每次将一个单独的分组发送之后，需要收到接收端的确认信息，发送端如若未收到确认信息，则进行该分组重发（可能是分组在数据链路层因为未通过检测被丢弃，可以因为线路堵塞超过定时器规定的时间**定时器的作用**）
 2. 接收到如果因收到因为超时重发的两个分组，则丢弃重复的分组
 3. 上述这种可靠协议常称为**自动重传请求**
 4. 以字节为单位的**滑动窗口**.在没有收到接受方的确认前,发送方可以连续把窗口内的数据都发送出去.以发送的数据在未收到接收方的确认下必须保留副本,以便超时重传.窗口大小受网络拥塞程序限制.收到确认之后窗口才前移放入新的代发送数据.

 ***
> 网络层

**网络层负责为分组交换网上的不同主机提供通信服务。在发送数据时，网络层把运输层产生的报文段或用户数据报封装成分组或包进行传送。在TCP/IP体系中，由于网络层使用IP协议，因此分组也叫做IP数据报，或简称为数据报。**


1. 网络层传输的基本数据单位为IP数据报
2. 主要协议有IP协议，ICAP协议，ARP协议（地址解析协议），RARP协议（逆地址解析协议）
3. 网络层向上只提供简单灵活的，无连接的，尽最大努力交付的数据报服务
4. RIP和OSPF协议（开放最短路径优先）都是分布式网络选择协议
5. 划分子网和使用子网掩码增加了灵活性
6. 网络层还可以实现拥塞控制、网际互连等功能；



***
> 数据链路层

**数据链路层常简称为链路层，数据链路层将网络层交下来的IP数据报组装成帧，每一帧包括数据和必要的控制信息（如同步信息，地址信息，差错控制等）。通过这些控制信息，我们就可以从中提取出数据部分，上交给网络层。控制信息还可以用来检测所收到的帧有无差错。如有差错，数据链路就简单地丢弃这个除了出了差错的帧，以免继续在网络中传送下去白白浪费网络资源**



1. 数据链路层传送的协议数据单元是帧
2. 数据链路层在不可靠的物理介质上提供可靠的传输
3. 数据链路层的**三个基本问题包括封装成帧，透明传输，错误检测**
4. 点对点协议PPP是数据链路层使用最多的一种，还有CSMA/CD协议
5. 通过CRC（循环冗余检验）检测收到帧有无差错，有差错则丢弃

**CSMA/CD协议（载波监听多点接入/碰撞检测**

**总线上只要有一台计算机在发送数据，总线的传输资源就会被占用。因此，在同一时间只能允许一台计算机发送数据**

*多点接入* ———————说明这是总线型网络

*载波监听* ———————不管在发送前还是在发送中，每个站必须不停的检测信道（发送中监听是因为传播时延的存在

*碰撞检测* ———————边发送边监听，如果在发送中发送碰撞，停止发送，在等待一段随机的时间后重新进行发送（因为传播时延的存在，**电磁波在1km电缆上的传播时延约为5us，常把发送端到接收端的传播时延写作a（书上的符号不会打），则最迟需要经过2a的时间才能确认数据是否发生碰撞**

**在使用CSMA/CD协议时，一个站不可以同时发送/接收数据，所以这个以太网不可能进行全双工通信，只能进行双向交替通信（半双工通信）**

传送端到接收端的传播时延*2，这个时间段内，发送站无法确认数据是否成功发送（有无发生碰撞冲突）。我们把这个时间段称为争用期（也叫做碰撞窗口）。如果过了这个时间段还是没有检测到碰撞，则该次数据可以顺利发送完毕。

如果争用期内发生冲突碰撞，则使用**截断二进制指数退避**

1. 协议规定了基本退避时间为争用期2a，具体的争用期时间为51.2us。对于10Mb/s的以太网，在争用期可以发送512bit数据，所以也可以称为争用期是512比特时间
2. 我们可以从离散的整数集合**[0，1，3，4，....，（2^k）-1]**里随机取出一个数，记为r。重传应推后的时间就是r倍的争用期。整数集合里的k参数取值  **k=Min（重传次数，10）**
3. 重传达16次仍不能成功，则丢弃该帧，并向上层报告


**CRC（循环冗余检验）检测**

待添加
***
> 物理层

**在物理层上所传数据的单位是比特，01数据流。物理层要考虑用多大的电压代表“0”或“1”，以及接收方如何识别出发送方所发出的比特。**


> 封装演示

![](http://static.zybuluo.com/Rico123/5isp5b3mn3arj4157ohb9hwg/PDU%E5%B0%81%E8%A3%85%E5%AE%9E%E4%BE%8B.png)


> 总结

乘客：应用层

**应用层协议的内容，就是我们直接要使用的数据，也是整个网络传输要传递的内容。**

指挥调度：运输层

**运输层是体系结构的调度者，管理着数据的传输的一些策略。**

向导：网络层

**网络层的是体系结构的向导，负责找到要到达接收方的路径。**

交通工具：数据链路层

**数据链路层里的协议就是要使用的交通工具了。**

道路：物理层


## RIP协议

RIP是一种最简单的内部网关协议

RIP协议是一个距离向量路由协议，它以跳数作为评价标准，跳数越少，距离越短，当跳数为16时，表示距离不可达。因此RIP协议只适用于小型网络。

RIP的路由表中主要包括“目的网络”、“下一跳地址”和“距离”这三个字段

RIP路由器总是会每隔30秒（这是默认值，可以修改，而且也可能与设置值有些偏差）通过UDP 520端口以RIP广播应答方式向邻居路由器发送的一个路由更新包，包中包括了本路由器上的完整的路由表。

每个路由器根据收到的路由更新包更新本路由器上的路由表

### 例题

**题目：假定网络中路由器B的路由表有以下项目：**


| 目的网络     | 距离    |  下一跳路由  |
| --------   | -----:   | :----: |
| N1       | 7      |   	A   |
| N2       |2     |   C   |
|N8   |  4 |   A|
|N9   | 12  | A  |

**现在B收到C发过来的路由信息**

| 目的网络     | 距离    |
| --------   | -----:   |
|  N2 |  	4 |   
|N3   | 8  |     
|N8   |  2 |   
|N9   | 15  |

**B收到C发过来的路由信息后，B的路由表更新为**

| 目的网络     | 距离    |  下一跳路由  |解释|
| --------   | -----:   | :----: |-------:|
|  N1 |7   |A   | C表中无信息，不更新|
|N2   | 4+1=5  |C   | 下一跳相同，更新  |
|N3   |9  |C   |  B表中无信息，添加 |
| N8  |2+1=3   |C   |跳C距离更短，更新B表   |
|N9   | 12  | A  |原表距离更短，不更新|




### 关于TCP的中文名

首先TCP的中文名字叫做**传输控制协议**。

它是一个能让数据在不可靠的数据链路层上实现可靠交付的一个协议。

提供面向连接的，可靠的数据传输服务，其数据传输的单位是报文段（尽管下层是不靠谱链接。

#### TCP如何在不可靠的数据链路层上实现可靠的交付服务？

1. TCP将报文段进行分组，每个分组上有一个定时器，发送端每次将一个单独的分组发送之后，需要收到接收端的确认信息，发送端如若未收到确认信息，则进行该分组重发（可能是分组在数据链路层因为未通过检测被丢弃，可以因为线路堵塞超过定时器规定的时间**定时器的作用**）
2. 接收到如果因收到因为超时重发的两个分组，则丢弃重复的分组
3. 上述这种可靠协议常称为**自动重传请求ARQ**

### 什么是HTTP呢？

首先HTTP的中文名字叫做**超文本传输协议**。（对不起我考试写成了超链接文本

HTTP被设计用来传输HTML页面，

### 什么是CSMA/CD协议呢？

首先它的中文名字叫做**载波监听多点接入/碰撞检测协议**


**总线上只要有一台计算机在发送数据，总线的传输资源就会被占用。因此，在同一时间只能允许一台计算机发送数据**

*多点接入* ———————说明这是总线型网络

*载波监听* ———————不管在发送前还是在发送中，每个站必须不停的检测信道（发送中监听是因为传播时延的存在

*碰撞检测* ———————边发送边监听，如果在发送中发送碰撞，停止发送，在等待一段随机的时间后重新进行发送（因为传播时延的存在，**电磁波在1km电缆上的传播时延约为5us，常把发送端到接收端的传播时延写作a（书上的符号不会打），则最迟需要经过2a的时间才能确认数据是否发生碰撞**

**在使用CSMA/CD协议时，一个站不可以同时发送/接收数据，所以这个以太网不可能进行全双工通信，只能进行双向交替通信（半双工通信）**

传送端到接收端的传播时延*2，这个时间段内，发送站无法确认数据是否成功发送（有无发生碰撞冲突）。我们把这个时间段称为争用期（也叫做碰撞窗口）。如果过了这个时间段还是没有检测到碰撞，则该次数据可以顺利发送完毕。

如果争用期内发生冲突碰撞，则使用**截断二进制指数退避**

1. 协议规定了基本退避时间为争用期2a，具体的争用期时间为51.2us。对于10Mb/s的以太网，在争用期可以发送512bit数据，所以也可以称为争用期是512比特时间
2. 我们可以从离散的整数集合**[0，1，3，4，....，（2^k）-1]**里随机取出一个数，记为r。重传应推后的时间就是r倍的争用期。整数集合里的k参数取值  **k=Min（重传次数，10）**
3. 重传达16次仍不能成功，则丢弃该帧，并向上层报告

## 什么是网络号，主机号呢？

ipv4类地址有4个字节，一个字节即八位。

详细如 0000 0000 . 0000 0000 . 0000 0000 . 0000 0000

**注意这是二进制下的表示**

A类地址，B类地址，C类地址等等区分的具体标准就是其网络号拥有几个字节，主机号拥有几个字节。

**A类地址**拥有的网络号为1个字节（即8位），拥有的主机号有3个字节（即24位）

**B类地址**拥有的网络号为2个字节（即16位），拥有的主机号有2个字节（即16位）

**C类地址**拥有的网络号为3个字节（即24位），拥有的主机号有1个字节（即8位）

在以太网里，网络号可以看作你家的具体地址（如在宁波理工15幢），而主机号看作在这个大概地址里你的精确地址（即316寝室）。

## 什么是子网划分呢？

网络号由于所占位数的限制，它有时候可以表示到很小的一个范围，有时候却表示一个很大的范围。上面例子我们可以看作是C类地址。

当我们把作B类地址举例子时，那么网络号可能就可以看作你所在的具体地址（如宁波理工），而主机号看作这个大概地址里的你的精确地址（即316寝室）。

**然而B类地址所拥有的主机号是C类的2^7倍（大概）**，我们很难从宁波理工整个生活园区派送给你信件。由于是B类地址，网络号只具体到整个宁波理工生活园区，而主机号却有三千左右个，我们如何更有效率的派送信件呢？

这就用到了**子网划分**。**就像网络号可以精确到宁波理工整个生活园区范围内，那我们能不能像网络号那样在生活园区里精确一片片区域呢？**

这时候就需要划分子网了。假定我们学校有30幢寝室楼，我们按寝室楼划分网络号（网络号不是已经在前16位已经分完了吗？哪里来的多余的网络号呢？），这时候我们就需要从主机号借位来把它当作网络号来应用，30幢寝室好像刚好可以用5个二进制位就可以表示，那我们就从后16位借前五位把它当作网络号吧。（这时候子网掩码（其实也可以看作网络号的位数）就从16位变成了16+5位了，子网掩码就变成了/21）。而剩余的主机位则继续当它的主机位，从000 00000000 - 111 11111111 。

**注意 000 0000000 我们一般默认为本网络号， 111 11111111为默认广播号。**

**既然能进行一次子网划分，那么就可以在子网划分上进行子网二级划分，道理同上，借位作网络号。**

注意网络号也有全为0 ，全为1 默认不可用（好像是这样的）

## 协议以及对应的中文名


	协议名	缩写

	互联网控制消息协议	ICMP

	互联网组管理协议	IGMP

	传输控制协议	TCP

	用户数据报协议	UDP

	IPv6封装	ENCAP

	开放式最短路径优先	OSPF

	流控制传输协议	SCTP

	地址解析协议 ARP

	逆地址解析协议 RARP
